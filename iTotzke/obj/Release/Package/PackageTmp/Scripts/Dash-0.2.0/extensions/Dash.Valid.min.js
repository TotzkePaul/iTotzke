/*!
 * Dash Valid JavaScript Library
 * Version 0.2.0
 * Extends the Dash JavaScript Library to include initialization for input validation.
 *
 * Copyright 2011, Eric Boll
 * Licensed under the GNU Lesser General Public License.
 * http://www.gnu.org/licenses/lgpl.html
 *
 * Uses the JQuery JavaScript Library under the MIT License
 * Copyright 2011, John Resig
 * http://jquery.org/license
 */
﻿
(function($){$.fn.dash.valid=function()
{if($(this).is("[data-valid-group='true']"))
{validateAndSubmit(null,$(":input:not('button')",this));}
if($(this).is(":input:not('button')"))
{var allAttr=this[0].attributes;var attr=[];var isRequired=false;for(var i=0;i<allAttr.length;i++)
{if(allAttr[i].name.indexOf("data-valid-")!=-1&&allAttr[i].name.indexOf("msg")==-1&&allAttr[i].value!="false")
{attr.splice(0,0,allAttr[i]);isRequired|=(allAttr[i].name=="data-valid-required"&&allAttr[i].value=="true");}}
var summary=$(this).parents("[data-valid-group='true']:first").find("[data-valid-summary]='true'");for(var i=0;i<attr.length;i++)
{var result=validators[attr[i].name]!=null;if(isRequired)
{result=validators[attr[i].name]($(this).val(),attr[i].value);}
else
{result=($(this).val()==""&&attr[i].name!="data-valid-custom")||validators[attr[i].name]($(this).val(),attr[i].value,$(this));}
var label=$("label[for='"+$(this).attr("id")+"']");if(summary.length!=0)
{$(label).next().remove();$(label).remove();}
else
{$(label).remove();}
if(result===true)
{$(this).removeClass("invalid").addClass("valid");continue;}
$(this).removeClass("valid").addClass("invalid");var messageText=$(this).attr(attr[i].name+"-msg");messageText=$.fn.dash.dev.resolveNamespace(messageText)||result;var message=$("<label class='invalid'></label>").attr("for",$(this).attr("id")).text(messageText);if(summary.length==0)
{$(message).insertAfter($(this));}
else
{$(summary).append(message).append("<br />");}
return false;}
return true;}};$.fn.dash.valid.init=function()
{var elements=$.fn.dash.dev.getCurrentElements.call(this,"[data-valid-group='true']");elements.each(function()
{var group=this;var triggers=$("[data-valid-trigger]",group).filter(function()
{return $(this).closest("[data-valid-group='true']")[0]==group;});var inputs=$(":input:not('button')",group);$(inputs).each(function()
{$(this).data("destroy",function($this)
{var allAttr=$this[0].attributes;var attr=[];var isRequired=false;for(var i=0;i<allAttr.length;i++)
{if(allAttr[i].name.indexOf("data-valid-")!=-1&&allAttr[i].value!="false")
{attr.splice(0,0,allAttr[i].name);}}
for(i in attr)
{$this.removeAttr(attr[i]);}});});$(triggers).each(function()
{var options=$(this).attr("data-valid-trigger").split(" ");var submit=function(event)
{validateAndSubmit(event,inputs);$(inputs).each(function()
{$(this).unbind("keyup.valid").bind("keyup.valid",function(){$(this).dash("valid");});});}
if(options[0]=="true")
{$(this).unbind("click.valid").bind("click.valid",submit);}
else
{var event=options[0];var handler=$.fn.dash.dev.resolveNamespace(options[1]);$(this).unbind(".valid").bind(event+".valid",submit);$(this).bind(event+".valid",handler);}
$(this).data("destroy",function($this)
{$this.unbind(".valid");});});$(inputs).not("textarea").unbind("keypress.valid").bind("keypress.valid",function(event)
{if(event.keyCode==13)
{event.preventDefault();event.stopPropagation();event.stopImmediatePropagation();$(":first",triggers).click();return false;}});$(this).data("destroy",function($this)
{$this.find(":input").dash("destroy");$this.find("label[class='invalid']").remove();$this.find(".valid,.invalid").removeClass("valid invalid");$this.find("[data-valid-summary='true'").empty();});});};var validators={"data-valid-custom":function(value,functionName)
{var result=$.fn.dash.dev.resolveNamespace(functionName)(value);return result===true?true:result===false?"Custom validation failed":result;},"data-valid-date":function(value)
{return/^[0-1]?[0-9]\/[0-3]?[0-9]\/(19|20)[0-9]{2}$/.test(value)?true:"Must be a valid date";},"data-valid-datetime":function(value)
{return/^[0-1]?[0-9]\/[0-3]?[0-9]\/(19|20)[0-9]{2}[0-2]?[0-9]:[0-5]?[0-9](:[0-5]?[0-9])?(AM|PM|am|pm)?$/.test(value)?true:"Must be a valid date-time";},"data-valid-decimal":function(value)
{return/^[-+]?[0-9]*\.?[0-9]+$/.test(value)?true:"Must be a valid decimal number";},"data-valid-digits":function(value)
{return/^[\d]+$/.test(value)?true:"Must be a valid integer";},"data-valid-email":function(value)
{return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value)?true:"Must be a valid email"},"data-valid-length-range":function(value,range)
{var min=parseInt(range.substring(0,range.indexOf("-")));var max=parseInt(range.substring(range.indexOf("-")+1));return(value.length>=min&&value.length<=max)?true:"Must contain between "+min+" and "+max+" characters";},"data-valid-max":function(value,max,field)
{if($(field).attr("data-valid-decimal")!=null)
{value=parseFloat(value);max=parseFloat(max);}
else
{value=parseInt(value);max=parseInt(max);}
return value<=max?true:"Must be less than or equal to "+max;},"data-valid-min":function(value,min,field)
{if($(field).attr("data-valid-decimal")!=null)
{value=parseFloat(value);min=parseFloat(min);}
else
{value=parseInt(value);min=parseInt(min);}
return value>=min?true:"Must be greater than or equal to "+min;},"data-valid-max-length":function(value,length)
{return value.length<=parseInt(length)?true:"May contain at most "+length+" characters";},"data-valid-min-length":function(value,length)
{return value.length>=parseInt(length)?true:"Must contain at least "+length+" characters";},"data-valid-phone":function(value)
{return/^(\(|)?[0-9]{3}(\)|)?(\-|.|)?[0-9]{3}(\-|.|)?[0-9]{4}$/.test(value)?true:"Must be a valid phone number";},"data-valid-range":function(value,range)
{var min;var max;if($(field).attr("data-valid-decimal")!=null)
{value=parseFloat(value);min=parseFloat(range.substring(0,range.indexOf("-")));max=parseFloat(range.substring(range.indexOf("-")+1));}
else
{value=parseInt(value);min=parseInt(range.substring(0,range.indexOf("-")));max=parseInt(range.substring(range.indexOf("-")+1));}
return(value>=min&&value<=max)?true:"Must be between "+min+" and "+max;},"data-valid-required":function(value)
{return value.replace(/^\s+|\s+$/g,"")!=""?true:"Required";},"data-valid-time":function(value)
{return/^[0-2]?[0-9]:[0-5]?[0-9](:[0-5]?[0-9])?(AM|PM|am|pm)?$/.test(value)?true:"Must be a valid time";}};var validateAndSubmit=function(event,inputFields)
{var isValid=true;for(var i=0;i<inputFields.length;i++)
{isValid&=$(inputFields[i]).dash("valid");}
if(!isValid&&event!=null)
{event.stopImmediatePropagation();event.preventDefault();}};$.fn.dash.initializers.push($.fn.dash.valid.init);$.extend($.fn.dash.methods,{"valid":$.fn.dash.valid});})(jQuery);